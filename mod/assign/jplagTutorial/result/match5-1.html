<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>ExampleConnect.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>ExampleConnect.java</CENTER></H3><HR>
<PRE>
<A NAME="0"></A><FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match5-0.html#0',2,'match5-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>package jplagTutorial;

import java.rmi.RemoteException;
import java.security.cert.X509Certificate;
import java.util.Iterator;

import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;
import javax.xml.rpc.handler.Handler;
import javax.xml.rpc.handler.HandlerChain;

import com.sun.xml.rpc.client.ClientTransportException;
import com.sun.xml.rpc.util.exception.JAXRPCExceptionBase;

import jplagTutorial.util.JPlagClientAccessHandler;
import jplagTutorial.jplagClient.JPlagException;
import</B></FONT> jplagTutorial.jplagClient.JPlagService_Impl;
import jplagTutorial.jplagClient.JPlagTyp_Stub;
import jplagTutorial.jplagClient.LanguageInfo;
import jplagTutorial.jplagClient.ServerInfo;
import jplagTutorial.jplagClient.Submission;
import jplagTutorial.jplagClient.UserInfo;

public class ExampleConnect {
    /**
     * Helper function to easily evaluate web service related exceptions
     * @param e Exception thrown by a stub method
     */
    public static void checkException(Exception e) {
        if(e instanceof JPlagException) {
            JPlagException je = (JPlagException) e;
            System.out.println(&quot;JPlagException: &quot; + je.getDescription()
                + &quot;\n&quot; + je.getRepair());
        }
        else if(e instanceof RemoteException) {
            RemoteException re = (RemoteException) e;
            Throwable cause = re.getCause();
            if(cause != null &amp;&amp; cause instanceof ClientTransportException) {
                cause = ((JAXRPCExceptionBase) cause).getLinkedException();
                if(cause != null) {
                    System.out.println(&quot;Connection exception: &quot;
                        + cause.getMessage());
                    return;
                }
            }
            System.out.println(&quot;Unexpected RemoteException: &quot;
                + re.getMessage());
            re.printStackTrace();
        }
        else {
            System.out.println(&quot;Unexpected Exception: &quot; + e.getMessage());
            e.printStackTrace();
        }
    }
    
    public static void main(String[] args) {
        String username = null, password = null;
        for(int i=0; i&lt;args.length; i++) {
            if(args[i].equals(&quot;-user&quot;) &amp;&amp; i+1&lt;args.length) {
                i++;
                username = args[i];
            }
            else if(args[i].equals(&quot;-pass&quot;) &amp;&amp; i+1&lt;args.length) {
                i++;
                password = args[i];
            }
        }
        if(username == null || password == null) {
            System.out.println(&quot;Usage: ExampleConnect [options]\n&quot;
                + &quot;Options are:\n&quot;
                + &quot; -user &lt;username&gt;      Sets the username (required)\n&quot;
                + &quot; -pass &lt;password&gt;      Sets the password (required)\n&quot;);
            return;
<A NAME="1"></A>        }
        
        // Create a trust manager that does not validate certificate chains
        TrustManager[] <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match5-0.html#1',2,'match5-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>trustAllCerts = new TrustManager[] {
            new X509TrustManager() {
                public X509Certificate[] getAcceptedIssuers() {
                    return null;
                }
                public void checkClientTrusted(X509Certificate[] certs,
                        String authType) {
                }
                public void checkServerTrusted(X509Certificate[] certs,
                        String authType) {
                }
            }
        };
        
        // Install the all-trusting trust manager
        try {
            SSLContext sc = SSLContext.getInstance(&quot;SSL&quot;);
            sc.init(null, trustAllCerts, new java.security.SecureRandom());
            HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());
        } catch</B></FONT> (Exception e) {
            System.out.println(&quot;Warning: Unable to install all-trusting trust &quot;
                + &quot;manager! SSL connection may not work!&quot;);
        }
        
        // Get JPlag client stub
        
        JPlagTyp_Stub stub = (JPlagTyp_Stub) (new JPlagService_Impl()
                .getJPlagServicePort());
                
        // Search for the JPlagClientAccessHandler in the handler chain

        HandlerChain handlerchain = stub._getHandlerChain();
        Iterator handlers = handlerchain.iterator();
        JPlagClientAccessHandler accessHandler = null;
        while(handlers.hasNext()) {
            Handler handler = (Handler) handlers.next();
            if(handler instanceof JPlagClientAccessHandler) {
                accessHandler = (JPlagClientAccessHandler) handler;
                break;
            }
        }
        
        if(accessHandler == null) {
            System.out.println(&quot;Unable to find access handler!&quot;);
            return;
        }
        
        // Initialize access handler
        
        accessHandler.setUserPassObjects(username, password);
        
        // Get ServerInfo and print out some infos
        
        ServerInfo info;
        
        try {
            info = stub.getServerInfo();
        } catch(Exception e) {
            checkException(e);
            return;
        }
        
        UserInfo userinfo = info.getUserInfo();
        System.out.println(&quot;User info:\n Email: &quot; + userinfo.getEmail()
            + &quot;\n Alternative email: &quot; + userinfo.getEmailSecond()
            + &quot;\n Homepage: &quot; + userinfo.getHomepage());
        
        System.out.println(&quot;\nAvailable languages:&quot;);
        LanguageInfo[] languages = info.getLanguageInfos();
        for(int i=0; i&lt;languages.length; i++) {
            System.out.print(&quot; - \&quot;&quot; + languages[i].getName()
                + &quot;\&quot;\n   default minimum match length = &quot;
                + languages[i].getDefMinMatchLen()
                + &quot;\n   default suffixes: &quot;);
            String[] suffixes = languages[i].getSuffixes();
            for(int j=0; j&lt;suffixes.length; j++) {
                System.out.print(suffixes[j]
                    + ((j==suffixes.length-1) ? &quot;\n&quot; : &quot;, &quot;));
            }
        }

        System.out.println(&quot;\nAvailable country languages:&quot;);
        String[] countryLangs = info.getCountryLanguages();
        for(int i=0; i&lt;countryLangs.length; i++)
            System.out.println(&quot; - \&quot;&quot; + countryLangs[i] + &quot;\&quot;&quot;);
        
        Submission[] subs = info.getSubmissions();
        if(subs.length == 0) {
            System.out.println(&quot;\nCurrently there are no submissions on the &quot;
                + &quot;server for this user!&quot;);
        }
        else {
            System.out.println(&quot;\nAvailable submissions with states:\n&quot;);
            for(int i=0; i&lt;subs.length; i++) {
                System.out.println(&quot; - \&quot;&quot; + subs[i].getTitle() + &quot;\&quot; (&quot;
                    + subs[i].getLastState() + &quot;)&quot;);
            }
        }
    }
}
</PRE>

</BODY>
</HTML>
